(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a(require("ol/control/Control"),require("ol/Observable"),require("ol/layer/Group")):typeof define==="function"&&define.amd?define(["ol/control/Control","ol/Observable","ol/layer/Group"],a):(b.LayerSwitcher=a(b.ol.control.Control,b.ol.Observable,b.ol.layer.Group))}(this,(function(b,f,h){b="default" in b?b["default"]:b;h="default" in h?h["default"]:h;var e=function(k,l){if(!(k instanceof l)){throw new TypeError("Cannot call a class as a function")}};var a=function(){function k(o,m){for(var l=0;l<m.length;l++){var n=m[l];n.enumerable=n.enumerable||false;n.configurable=true;if("value" in n){n.writable=true}Object.defineProperty(o,n.key,n)}}return function(n,l,m){if(l){k(n.prototype,l)}if(m){k(n,m)}return n}}();var c=function c(l,o,n){if(l===null){l=Function.prototype}var p=Object.getOwnPropertyDescriptor(l,o);if(p===undefined){var m=Object.getPrototypeOf(l);if(m===null){return undefined}else{return c(m,o,n)}}else{if("value" in p){return p.value}else{var k=p.get;if(k===undefined){return undefined}return k.call(n)}}};var g=function(l,k){if(typeof k!=="function"&&k!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof k)}l.prototype=Object.create(k&&k.prototype,{constructor:{value:l,enumerable:false,writable:true,configurable:true}});if(k){Object.setPrototypeOf?Object.setPrototypeOf(l,k):l.__proto__=k}};var j=function(k,l){if(!k){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return l&&(typeof l==="object"||typeof l==="function")?l:k};var d="layer-switcher-";var i=function(q){g(A,q);function A(H){e(this,A);var F=Object.assign({},H);var G=document.createElement("div");var I=j(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,{element:G,target:F.target}));I.activationMode=F.activationMode||"mouseover";I.startActive=F.startActive===true;I.label=F.label!==undefined?F.label:"";I.collapseLabel=F.collapseLabel!==undefined?F.collapseLabel:"\xBB";I.tipLabel=F.tipLabel?F.tipLabel:"Legend";I.collapseTipLabel=F.collapseTipLabel?F.collapseTipLabel:"Collapse legend";I.groupSelectStyle=A.getGroupSelectStyle(F.groupSelectStyle);I.reverse=F.reverse!==false;I.mapListeners=[];I.hiddenClassName="ol-unselectable ol-control layer-switcher";if(A.isTouchDevice_()){I.hiddenClassName+=" touch"}I.shownClassName="shown";G.className=I.hiddenClassName;I.button=document.createElement("button");G.appendChild(I.button);I.panel=document.createElement("div");I.panel.className="panel";G.appendChild(I.panel);A.enableTouchScroll_(I.panel);G.classList.add(d+"group-select-style-"+I.groupSelectStyle);G.classList.add(d+"activation-mode-"+I.activationMode);if(I.activationMode==="click"){G.classList.add("activationModeClick");I.button.onclick=function(K){var J=K||window.event;if(I.element.classList.contains(I.shownClassName)){I.hidePanel()}else{I.showPanel()}J.preventDefault()}}else{I.button.onmouseover=function(){I.showPanel()};I.button.onclick=function(K){var J=K||window.event;I.showPanel();J.preventDefault()};I.panel.onmouseout=function(J){if(!I.panel.contains(J.relatedTarget)){I.hidePanel()}}}I.updateButton();return I}a(A,[{key:"setMap",value:function C(H){var G=this;for(var F=0;F<this.mapListeners.length;F++){f.unByKey(this.mapListeners[F])}this.mapListeners.length=0;c(A.prototype.__proto__||Object.getPrototypeOf(A.prototype),"setMap",this).call(this,H);if(H){if(this.startActive){this.showPanel()}else{this.renderPanel()}if(this.activationMode!=="click"){this.mapListeners.push(H.on("pointerdown",function(){G.hidePanel()}))}}}},{key:"showPanel",value:function B(){if(!this.element.classList.contains(this.shownClassName)){this.element.classList.add(this.shownClassName);this.updateButton();this.renderPanel()}this.dispatchEvent("show")}},{key:"hidePanel",value:function l(){if(this.element.classList.contains(this.shownClassName)){this.element.classList.remove(this.shownClassName);this.updateButton()}this.dispatchEvent("hide")}},{key:"updateButton",value:function s(){if(this.element.classList.contains(this.shownClassName)){this.button.textContent=this.collapseLabel;this.button.setAttribute("title",this.collapseTipLabel);this.button.setAttribute("aria-label",this.collapseTipLabel)}else{this.button.textContent=this.label;this.button.setAttribute("title",this.tipLabel);this.button.setAttribute("aria-label",this.tipLabel)}}},{key:"renderPanel",value:function m(){this.dispatchEvent("render");A.renderPanel(this.getMap(),this.panel,{groupSelectStyle:this.groupSelectStyle,reverse:this.reverse});this.dispatchEvent("rendercomplete")}}],[{key:"renderPanel",value:function m(K,G,H){var F=new Event("render");G.dispatchEvent(F);H=H||{};H.groupSelectStyle=A.getGroupSelectStyle(H.groupSelectStyle);A.ensureTopVisibleBaseLayerShown(K,H.groupSelectStyle);while(G.firstChild){G.removeChild(G.firstChild)}A.forEachRecursive(K,function(N,M,O){N.set("indeterminate",false)});if(H.groupSelectStyle==="children"||H.groupSelectStyle==="none"){A.setGroupVisibility(K)}else{if(H.groupSelectStyle==="group"){A.setChildVisibility(K)}}var I=document.createElement("ul");G.appendChild(I);A.renderLayers_(K,K,I,H,function J(M){A.renderPanel(K,G,H)});var L=new Event("rendercomplete");G.dispatchEvent(L)}},{key:"isBaseGroup",value:function E(F){if(F instanceof h){var G=F.getLayers().getArray();return G.length&&G[0].get("type")==="base"}else{return false}}},{key:"setGroupVisibility",value:function z(G){var F=A.getGroupsAndLayers(G,function(H){return H instanceof h&&!H.get("combine")&&!A.isBaseGroup(H)}).reverse();F.forEach(function(H){var I=H.getLayersArray().map(function(J){var K=J.getVisible();return K});if(I.every(function(J){return J===true})){H.setVisible(true);H.set("indeterminate",false)}else{if(I.every(function(J){return J===false})){H.setVisible(false);H.set("indeterminate",false)}else{H.setVisible(true);H.set("indeterminate",true)}}})}},{key:"setChildVisibility",value:function x(G){var F=A.getGroupsAndLayers(G,function(H){return H instanceof h&&!H.get("combine")&&!A.isBaseGroup(H)});F.forEach(function(H){var J=H;var K=J.getVisible();var I=J.get("indeterminate");J.getLayers().getArray().forEach(function(L){L.set("indeterminate",false);if((!K||I)&&L.getVisible()){L.set("indeterminate",true)}})})}},{key:"ensureTopVisibleBaseLayerShown",value:function k(H,F){var G=void 0;A.forEachRecursive(H,function(K,J,I){if(K.get("type")==="base"&&K.getVisible()){G=K}});if(G){A.setVisible_(H,G,true,F)}}},{key:"getGroupsAndLayers",value:function o(F,H){var G=[];H=H||function(K,J,I){return true};A.forEachRecursive(F,function(K,J,I){if(K.get("title")){if(H(K,J,I)){G.push(K)}}});return G}},{key:"setVisible_",value:function p(H,G,I,F){G.setVisible(I);if(I&&G.get("type")==="base"){A.forEachRecursive(H,function(L,K,J){if(L!=G&&L.get("type")==="base"){L.setVisible(false)}})}if(G instanceof h&&!G.get("combine")&&F==="children"){G.getLayers().forEach(function(J){A.setVisible_(H,J,G.getVisible(),F)})}}},{key:"renderLayer_",value:function w(G,J,N,U,H){var R=document.createElement("li");var Q=J.get("title");var P=A.uuid();var M=document.createElement("label");if(J instanceof h&&!J.get("combine")){var O=A.isBaseGroup(J);R.classList.add("group");if(O){R.classList.add(d+"base-group")}if(J.get("fold")){R.classList.add(d+"fold");R.classList.add(d+J.get("fold"));var I=document.createElement("button");I.onclick=function(W){var V=W||window.event;A.toggleFold_(J,R);V.preventDefault()};R.appendChild(I)}if(!O&&U.groupSelectStyle!="none"){var L=document.createElement("input");L.type="checkbox";L.id=P;L.checked=J.getVisible();L.indeterminate=J.get("indeterminate");L.onchange=function(W){var V=W.target;A.setVisible_(G,J,V.checked,U.groupSelectStyle);H(J)};R.appendChild(L);M.htmlFor=P}M.innerHTML=Q;R.appendChild(M);var K=document.createElement("ul");R.appendChild(K);A.renderLayers_(G,J,K,U,H)}else{R.className="layer";var T=document.createElement("input");if(J.get("type")==="base"){T.type="radio"}else{T.type="checkbox"}T.id=P;T.checked=J.get("visible");T.indeterminate=J.get("indeterminate");T.onchange=function(W){var V=W.target;A.setVisible_(G,J,V.checked,U.groupSelectStyle);H(J)};R.appendChild(T);M.htmlFor=P;M.innerHTML=Q;var F=G.getView().getResolution();if(F>=J.getMaxResolution()||F<J.getMinResolution()){M.className+=" disabled"}else{if(J.getMinZoom&&J.getMaxZoom){var S=G.getView().getZoom();if(S<=J.getMinZoom()||S>J.getMaxZoom()){M.className+=" disabled"}}}R.appendChild(M)}return R}},{key:"renderLayers_",value:function D(L,H,M,G,J){var K=H.getLayers().getArray().slice();if(G.reverse){K=K.reverse()}for(var I=0,F;I<K.length;I++){F=K[I];if(F.get("title")){M.appendChild(A.renderLayer_(L,F,I,G,J))}}}},{key:"forEachRecursive",value:function y(F,G){F.getLayers().forEach(function(J,H,I){G(J,H,I);if(J instanceof h){A.forEachRecursive(J,G)}})}},{key:"uuid",value:function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(H){var G=Math.random()*16|0,F=H=="x"?G:G&3|8;return F.toString(16)})}},{key:"enableTouchScroll_",value:function v(G){if(A.isTouchDevice_()){var F=0;G.addEventListener("touchstart",function(H){F=this.scrollTop+H.touches[0].pageY},false);G.addEventListener("touchmove",function(H){this.scrollTop=F-H.touches[0].pageY},false)}}},{key:"isTouchDevice_",value:function n(){try{document.createEvent("TouchEvent");return true}catch(F){return false}}},{key:"toggleFold_",value:function r(G,F){F.classList.remove(d+G.get("fold"));G.set("fold",G.get("fold")==="open"?"close":"open");F.classList.add(d+G.get("fold"))}},{key:"getGroupSelectStyle",value:function t(F){return["none","children","group"].indexOf(F)>=0?F:"children"}}]);return A}(b);if(window.ol&&window.ol["control"]){window.ol["control"]["LayerSwitcher"]=i}return i})));
